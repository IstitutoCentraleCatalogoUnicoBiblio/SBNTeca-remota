var ie=Object.defineProperty,ae=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var W=(e,t,i)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,k=(e,t)=>{for(var i in t||(t={}))oe.call(t,i)&&W(e,i,t[i]);if(G)for(var i of G(t))de.call(t,i)&&W(e,i,t[i]);return e},U=(e,t)=>ae(e,re(t));import{_ as I,T as q,r as v,o as d,c as n,a as y,b as a,g as ne,d as $,e as ce,f as ue,h as me,u as H,R as he,t as S,i as _,F as g,j as M,w as L,n as w,k as z,p as pe,l as fe,m as D,q as ye,s as be,v as ge,x as T,y as O,z as Y,A as K,B as ve,C as xe,S as _e,M as we,D as Ie,E as ke,G as Ae,H as Me,I as Ee,J as Te}from"./vendor.452eb979.js";const Se=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}};Se();const Ce=(e,t)=>{let i=JSON.parse(JSON.stringify(t));return e["mets.mets"]=k(k({},i["mets.mets"]),e["mets.mets"]),console.log(e),e["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"]||(e["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"]=[]),e},X=(e,t,i,r)=>{var s,l;e.TYPE==="FOLDER"?(s=e["mets.div"])==null||s.map(o=>X(o,t,i,r)):e.TYPE==="FILE"&&((l=e["mets.fptr"])==null?void 0:l.find(o=>o.FILEID===t))&&(e[i]=r)},B=(e,t,i,r,s)=>{let l;return t.forEach(o=>{o.TYPE==="FOLDER"?(i+=1,l={id:i,text:o.LABEL,state:{checked:!1,selected:!1,expanded:!1},nodes:[],media:[]},i=B(l.nodes,o["mets.div"],i,l.media,s),e.push(l)):(!s||o["mets.fptr"][0].FILEID!==s)&&r.push(o)}),i},Z=(e,t,i)=>{let r;return t.forEach(s=>{i+=1,r={TYPE:"FOLDER",ORDER:i,LABEL:s.text,"mets.div":[]},i=Z(r["mets.div"],s.nodes,i),s.media.forEach(l=>{i+=1,r["mets.div"].push({TYPE:l.TYPE,ORDER:i,LABEL:l.LABEL,"mets.fptr":JSON.parse(JSON.stringify(l["mets.fptr"]))})}),e.push(r)}),i};function R(e,t,i){if(E)return;let r,s;Object.keys(e).forEach(l=>{var o,c,x;switch(e[l].type){case"block":R(e[l].child,t,e[l]);break;case"group":r=e[l].key||l,s=(Array.isArray(t)?(o=t.find(p=>p.hasOwnProperty(r)))==null?void 0:o[r]:t==null?void 0:t[r])||{},R(e[l].child,s,e[l]);break;default:!E&&e[l].mandatory&&(i!=null&&i.filter?(s=[],Array.isArray(t)&&(t==null||t.forEach(p=>{i.filter(p)&&s.push(p)}))):s=t,i!=null&&i.multi?E=Array.isArray(t)&&s.findIndex(p=>{var m,h;return e[l].singleArray?!(e[l].objectValue?p[l]?(m=p[l][0])==null?void 0:m.value:!1:p[l]?p[l][0]:!1):!(e[l].objectValue?(h=p==null?void 0:p[l])==null?void 0:h.value:p==null?void 0:p[l])})>-1:i!=null&&i.arrayObjectModel?E=s.findIndex(p=>p.type===l&&p.value)===-1:(s=Array.isArray(s)?s[0]:s,e[l].singleArray?E=!(e[l].objectValue?s!=null&&s[l]?(c=s==null?void 0:s[l][0])==null?void 0:c.value:!1:s!=null&&s[l]?s==null?void 0:s[l][0]:!1):E=!(e[l].objectValue?(x=s==null?void 0:s[l])==null?void 0:x.value:s==null?void 0:s[l])),console.log(l,E));break}})}let Q=!1,E=!1,N=!1,V=!1;const De=(e,t)=>{const i=e["mets.mets"]["mets.dmdSec"].find(s=>s.hasOwnProperty("mets.mdWrap")&&s["mets.mdWrap"].hasOwnProperty("mets.xmlData")&&s["mets.mdWrap"]["mets.xmlData"].hasOwnProperty("mods.mods"))["mets.mdWrap"]["mets.xmlData"]["mods.mods"],r=e["mets.mets"]["mets.amdSec"].find(s=>s.hasOwnProperty("mets.rightsMD"))["mets.rightsMD"][0]["mets.mdWrap"]["mets.xmlData"]["rights.RightsDeclarationMD"];return E=!1,N=!1,R(t["mets.amdSec"],r),E&&(N=!0),E=!1,V=!1,R(t["mets.dmdSec"],i),E&&(V=!0),Q=!0,console.log(N,V),N||V},ee=()=>Q,Oe=()=>N,Le=()=>V;const Ne={components:{Tree:q},props:{treeData:Array},data(){return{treeDisplayData:this.treeData}},computed:{treeStyles(){return{tree:{style:{height:"auto",maxHeight:"100%",overflowY:"visible",display:"inline-block",textAlign:"left"}},row:{style:{width:"auto"},child:{class:"h-auto hover:text-primary",style:{height:"30px"},active:{class:"",style:{height:"30px"}}}},selectIcon:{class:""},text:{style:{},class:"",active:{style:{color:"var(--color-primary)","font-weight":600}}}}},treeOptions(){return{treeEvents:{},events:{selected:{state:!0,fn:e=>{e.id!=="root"&&(this.$refs["sidebar-tree"].selectNode(e.id),this.$router.push(`/mets/${e.id}`))}},editableName:{state:!0,fn:e=>{e.id!=="root"&&(this.$refs["sidebar-tree"].selectNode(e.id),this.$router.push(`/mets/${e.id}`))}}}}}},mounted(){console.log("MOUNTED")},created(){this.emitter.on("check-data",e=>{e.check&&(Oe()?document.querySelectorAll('[data-id="amdSec"]')[0].classList.add("invalid"):document.querySelectorAll('[data-id="amdSec"]')[0].classList.remove("invalid"),Le()?document.querySelectorAll('[data-id="dmdSec"]')[0].classList.add("invalid"):document.querySelectorAll('[data-id="dmdSec"]')[0].classList.remove("invalid"))})},methods:{publish(){this.emitter.emit("publish")}},watch:{$route(e,t){this.$refs["sidebar-tree"].selectNode(e.params.id)}}},Ve={class:"w-full h-full p-4"},je={class:"text-center mt-10"};function Re(e,t,i,r,s,l){const o=v("Tree");return d(),n("div",Ve,[y(o,{id:"sidebar-tree",ref:"sidebar-tree","custom-options":l.treeOptions,"custom-styles":l.treeStyles,nodes:s.treeDisplayData},null,8,["custom-options","custom-styles","nodes"]),a("div",je,[a("button",{class:"text-primary bg-transparent border border-solid border-primary hover:bg-primary hover:text-white active:bg-primary font-semibold uppercase text-sm px-6 py-2 outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",type:"button",onClick:t[0]||(t[0]=(...c)=>l.publish&&l.publish(...c))},"Pubblica in Teca")])])}var Pe=I(Ne,[["render",Re]]),A={appBaseUrl:window.BASE_URL||"https://stage-teca-remota.devworkbench.it/TecaDigitaleSystem/",thumbnail:{AUDIO:"images/audio_icon.png",VIDEO:"images/video_icon.png",TEXT:"images/doc_icon.png"}};const Ue=[{id:"root",text:"Struttura METS",checkable:!1,selectable:!1,expandable:!1,state:{checked:!1,selected:!1,expanded:!0},nodes:[{id:"metsHdr",text:"metsHdr",checkable:!1,selectable:!0,expandable:!1,state:{checked:!1,selected:!1,expanded:!1}},{id:"dmdSec",text:"dmdSec (mods)",checkable:!1,selectable:!0,expandable:!1,state:{checked:!1,selected:!1,expanded:!1}},{id:"amdSec",text:"amdSec (rights)",checkable:!1,selectable:!0,expandable:!1,state:{checked:!1,selected:!1,expanded:!1}},{id:"structMap",text:"structMap",checkable:!1,selectable:!0,expandable:!1,state:{checked:!1,selected:!1,expanded:!1}},{id:"fileSec",text:"fileSec",checkable:!1,selectable:!0,expandable:!1,state:{checked:!1,selected:!1,expanded:!1}}]}],J={"mets.metsHdr":{RECORDSTATUS:{label:"Stato del record",type:"vocabolary",values:["completo","incompleto"]},CREATEDATE:{label:"Data di creazione",type:"text",readonly:!0},LASTMODDATE:{label:"Data ultima modifica",type:"text",readonly:!0},"mets.agent":{label:"Agente",type:"group",multi:!0,default:[],child:{ROLE:{label:"Ruolo",type:"vocabolary",values:["CREATOR","EDITOR","ARCHIVIST","PRESERVATION","DISSEMINATOR","CUSTODIAN","IPOWNER","OTHER"],otherAttribute:"OTHERROLE",default:""},TYPE:{label:"Tipo",type:"vocabolary",values:["INDIVIDUAL","ORGANIZATION","OTHER"],otherAttribute:"OTHERTYPE",default:""},"mets.name":{label:"Nome",type:"text",default:""}}}},"mets.dmdSec":{"##":{label:"Caratteristiche bibliografiche",type:"block",child:{"mods.originInfo":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,filter:e=>!e.hasOwnProperty("eventType"),child:{"mods.issuance":{label:"Livello bibliografico",type:"vocabolary",values:["continuing","monographic","serial","multipart monograph","serial","integrating resource"],singleArray:!0,mandatory:!0}}},"mods.typeOfResource":{label:"Tipologia",type:"vocabolary",values:["testo a stampa","materiale cartografico","musica notata","registrazione sonora musicale","registrazione sonora non musicale","registrazione sonora","grafica","materiale video e da proiezione","oggetto","materiale multimediale","risorsa elettronica"],singleArray:!0,objectValue:!0},"mods.genre":{label:"Tipologia specifica",type:"text",singleArray:!0,objectValue:!0}}},"mods.identifier":{label:"Identificazione",type:"group",arrayObjectModel:["logicalId","managementId","conservativeId","dossierId"],default:[],child:{logicalId:{label:"Identificativo logico",type:"text",default:"",mandatory:!0,url:"rest/editor/sbnRequest/mods?identifier=:value"},managementId:{label:"Identificativo di gestione",type:"text",default:"",mandatory:!0},conservativeId:{label:"Identificativo di conservazione",type:"text",default:"",mandatory:!0},dossierId:{label:"Identificativo parte/digitalizzazione",type:"text",default:""},other:{label:"Altri Identificativi",type:"group",multi:!0,child:{value:{label:"Identificativo",type:"text",default:""},type:{label:"Tipo",type:"vocabolary",values:["BID","DOI","ISBN","ISSN","SIGI","uri","locale","ARK"],default:""}}}}},"mods.titleInfo":{label:"Titolo",type:"group",default:[{}],filter:e=>!e.hasOwnProperty("type")&&!e.hasOwnProperty("otherType"),forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0,mandatory:!0},"mods.subTitle":{label:"Sottotitolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},"mods.partNumber":{label:"Numero della parte",type:"text",singleArray:!0,objectValue:!0},"mods.partName":{label:"Nome della parte",type:"text",singleArray:!0,objectValue:!0}}},"mods.part":{label:"Elementi specifici",type:"group",default:[{type:"issue"}],forceUpdate:!0,child:{"mods.detail":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.number":{label:"Numero",type:"text",singleArray:!0,objectValue:!0,mandatory:!0}}},"mods.date":{label:"Data",type:"text",singleArray:!0,objectValue:!0,mandatory:!0}}},"mods.name":{label:"Responsabilit\xE0 principale",type:"group",default:[],forceUpdate:!0,multi:!0,otherAttributes:{usage:"primary"},filter:e=>e.usage==="primary",child:{type:{label:"Tipo",type:"vocabolary",values:["personal","corporate","conference","family"],mandatory:!0,default:""},"mods.namePart":{label:"Nome",type:"text",singleArray:!0,objectValue:!0,mandatory:!0},"mods.nameIdentifier":{label:"Identificativo",type:"text",singleArray:!0,objectValue:!0},"mods.role":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.roleTerm":{label:"Ruolo",type:"text",singleArray:!0,objectValue:!0,otherAttributes:{type:"text"}}}}}},"mods.name2":{key:"mods.name",label:"Responsabilit\xE0 secondaria",type:"group",default:[],forceUpdate:!0,multi:!0,filter:e=>e.usage!=="primary",child:{type:{label:"Tipo",type:"vocabolary",values:["personal","corporate","conference","family"],mandatory:!0,default:""},"mods.namePart":{label:"Nome",type:"text",singleArray:!0,objectValue:!0,mandatory:!0},"mods.nameIdentifier":{label:"Identificativo",type:"text",singleArray:!0,objectValue:!0},"mods.role":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.roleTerm":{label:"Ruolo",type:"text",singleArray:!0,objectValue:!0,otherAttributes:{type:"text"}}}}}},"mods.originInfo2":{key:"mods.originInfo",label:"Pubblicazione/produzione",type:"group",default:[{}],filter:e=>!e.hasOwnProperty("eventType"),child:{"mods.place":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.placeTerm":{label:"Luogo",type:"text",singleArray:!0,objectValue:!0,otherAttributes:{type:"text"}}}},"mods.publisher":{label:"Editore",type:"text",singleArray:!0,objectValue:!0},"mods.dateIssued":{label:"Data di pubblicazione",type:"text",singleArray:!0,objectValue:!0},"mods.dateCreated":{label:"Data di creazione",type:"text",singleArray:!0,objectValue:!0}}},"mods.originInfo3":{key:"mods.originInfo",label:"Datazione",type:"group",default:[{}],forceUpdate:!0,multi:!0,filter:e=>e.hasOwnProperty("eventType"),child:{eventType:{label:"Tipologia",type:"text",default:""},"mods.dateOther":{type:"range",values:["approssimata","dedotta","dubbia"]}}},"mods.language":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.languageTerm":{label:"Lingua",type:"group",multi:!0,default:[],filter:e=>e.type==="code"&&e.hasOwnProperty("authority"),otherAttributes:{type:"code",authority:""},child:{value:{label:"Lingua",type:"text",default:"",disableDelete:!0}}}}},"##2":{label:"Soggetti e classificazione",type:"block",child:{"mods.subject":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.topic":{label:"Argomento",type:"group",multi:!0,default:[],child:{value:{label:"Argomento",type:"text",default:""}}},"mods.geographic":{label:"Luogo",type:"group",multi:!0,default:[],child:{value:{label:"Luogo",type:"text",default:""}}},"mods.temporal":{label:"Tempo",type:"group",multi:!0,default:[],child:{value:{label:"Tempo",type:"text",default:""}}},"mods.name":{type:"group",hidden:!0,default:[{}],forceUpdate:!0,child:{"mods.namePart":{label:"Persona",type:"group",multi:!0,default:[],child:{value:{label:"Persona",type:"text",default:""}}}}},"mods.genre":{label:"Genere",type:"group",multi:!0,default:[],child:{value:{label:"Genere",type:"text",default:""}}}}},"mods.classification":{label:"Classificazione",type:"group",multi:!0,default:[],child:{value:{label:"Classificazione",type:"text",default:""}}}}},"##3":{label:"Legami di titolo",type:"block",child:{"mods.relatedItem":{type:"group",default:[{type:"series"}],filter:e=>e.type==="series",hidden:!0,forceUpdate:!0,child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Collana",type:"text",singleArray:!0,objectValue:!0,textarea:!0}}}}},"mods.titleInfo":{label:"Titolo alternativo",type:"group",default:[],filter:e=>e.type==="alternative",multi:!0,otherAttributes:{type:"alternative"},child:{"mods.title":{label:"Titolo alternativo",type:"text",singleArray:!0,objectValue:!0,textarea:!0}}},"mods.titleInfo2":{key:"mods.titleInfo",label:"Titolo parallelo",type:"group",default:[],filter:e=>e.type==="translated",multi:!0,otherAttributes:{type:"translated"},child:{"mods.title":{label:"Titolo parallelo",type:"text",singleArray:!0,objectValue:!0,textarea:!0}}},"mods.titleInfo3":{key:"mods.titleInfo",label:"Variante del titolo",type:"group",default:[],filter:e=>e.otherType==="variantTitle",multi:!0,otherAttributes:{otherType:"variantTitle"},child:{"mods.title":{label:"Variante del titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0}}},"mods.titleInfo4":{key:"mods.titleInfo",label:"Titolo dell'opera",type:"group",default:[],filter:e=>e.type==="uniform",multi:!0,otherAttributes:{type:"uniform"},child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"##4":{label:"Note",type:"block",child:{"mods.note":{label:"Note",type:"group",default:[],multi:!0,child:{value:{label:"Nota",type:"text",default:"",textarea:!0,disableDelete:!0},type:{label:"Tipo",type:"text",default:"",textarea:!0,disableDelete:!0}}},"mods.abstract":{label:"Abstract",type:"group",default:[],multi:!0,child:{value:{label:"Abstract",type:"text",default:"",disableDelete:!0},type:{label:"Tipo",type:"text",default:"",disableDelete:!0}}}}},"##5":{label:"Legami tra notizie",type:"block",child:{"mods.relatedItem2":{key:"mods.relatedItem",label:"Collezione digitale",type:"group",default:[],multi:!0,filter:e=>e.otherType==="digitalCollection",otherAttributes:{otherType:"digitalCollection"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Collezione digitale",type:"text",singleArray:!0,objectValue:!0,textarea:!0}}}}},"mods.relatedItem3":{key:"mods.relatedItem",label:"Altro titolo",type:"group",default:[],multi:!0,filter:e=>e.otherType==="otherTitle",otherAttributes:{otherType:"otherTitle"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem4":{key:"mods.relatedItem",label:"Pubblicato con",type:"group",default:[],multi:!0,filter:e=>e.otherType==="issuedWith",otherAttributes:{otherType:"issuedWith"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem5":{key:"mods.relatedItem",label:"Fa parte di",type:"group",default:[],multi:!0,filter:e=>e.type==="constituent",otherAttributes:{type:"constituent"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem6":{key:"mods.relatedItem",label:"Comprende",type:"group",default:[],multi:!0,filter:e=>e.type==="host",otherAttributes:{type:"host"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem7":{key:"mods.relatedItem",label:"Elemento di raggruppamento",type:"group",default:[],multi:!0,filter:e=>e.otherType==="grouping",otherAttributes:{otherType:"grouping"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem8":{key:"mods.relatedItem",label:"Risorse collegate",type:"group",default:[],multi:!0,filter:e=>e.otherType==="relatedResource",otherAttributes:{otherType:"relatedResource"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem9":{key:"mods.relatedItem",label:"Vedi anche",type:"group",default:[],multi:!0,filter:e=>e.otherType==="seeAlso",otherAttributes:{otherType:"seeAlso"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.relatedItem10":{key:"mods.relatedItem",label:"Fonte",type:"group",default:[],multi:!0,filter:e=>e.type==="original",otherAttributes:{type:"original"},child:{"mods.titleInfo":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.title":{label:"Titolo",type:"text",singleArray:!0,objectValue:!0,textarea:!0},ID:{label:"Identificativo",type:"text",default:""}}}}},"mods.location":{label:"Descrizione dell'esemplare",type:"group",default:[{}],forceUpdate:!0,child:{"mods.physicalLocation":{label:"Localizzazione",type:"text",singleArray:!0,objectValue:!0},"mods.holdingSimple":{type:"group",default:{},hidden:!0,forceUpdate:!0,child:{"mods.copyInformation":{type:"group",default:[{}],hidden:!0,forceUpdate:!0,child:{"mods.itemIdentifier":{label:"Inventario",type:"text",singleArray:!0,objectValue:!0},"mods.shelfLocator":{label:"Collocazione",type:"text",singleArray:!0,objectValue:!0}}}}}}}}}},"mets.amdSec":{"rights.RightsDeclaration":{label:"Dichiarazione",type:"text",singleArray:!0,mandatory:!0},"rights.RightsHolder":{label:"Detentore",type:"group",multi:!0,default:[],child:{"rights.RightsHolderName":{label:"Denominazione/nome",type:"text",singleArray:!0,mandatory:!0},"rights.RightsHolderComments":{label:"Note",type:"text",singleArray:!0},"rights.RightsHolderContact":{label:"Contatti",type:"group",singleArray:!0,default:[{"rights.RightsHolderContactDesignation":[],"rights.RightsHolderContactAddress":[],"rights.RightsHolderContactEmail":[]}],child:{"rights.RightsHolderContactDesignation":{label:"Designazione",type:"text",singleArray:!0},"rights.RightsHolderContactAddress":{label:"Indirizzo",type:"text",singleArray:!0},"rights.RightsHolderContactEmail":{label:"E-mail",type:"text",singleArray:!0}}}}},"rights.Context":{label:"Licenze",type:"group",multi:!0,default:[],child:{CONTEXTCLASS:{label:"Categoria",type:"vocabolary",values:["ACADEMIC USER","GENERAL PUBLIC","REPOSITORY MGR","MANAGED GRP","INSTITUTIONAL AFFILIATE","OTHER"],otherAttribute:"OTHERCONTEXTTYPE",default:""},"rights.Permissions":{label:"Permessi",type:"group",singleArray:!0,rowDirectChildren:!0,default:[{}],child:{DISCOVER:{type:"check"},DISPLAY:{type:"check"},COPY:{type:"check"},DUPLICATE:{type:"check"},MODIFY:{type:"check"},DELETE:{type:"check"},PRINT:{type:"check"},OTHER:{type:"check",otherAttribute:"OTHERPERMITTYPE"}}},"rights.Constraints":{label:"Vincoli",type:"group",multi:!0,default:[],child:{CONSTRAINTTYPE:{label:"Vincolo",type:"vocabolary",values:["QUALITY","FORMAT","UNIT","WATERMARK","PAYMENT","COUNT","RE-USE","ATTRIBUTION","TIME","TRANSFERPERMISSIONS","OTHER"],otherAttribute:"OTHERCONSTRAINTTYPE",default:""},"rights.ConstraintDescription":{label:"Note",type:"text",singleArray:!0}}}}}},"mets.structMap":{PHYSICAL:"Struttura fisica",LOGICAL:"Struttura logica"},"mets.fileSec":{IMAGE:"Immagini",AUDIO:"Audio",VIDEO:"Video",TEXT:"Pdf"}},$e={"mets.mets":{"mets.metsHdr":{},"mets.dmdSec":[{"mets.mdWrap":{"mets.xmlData":{"mods.mods":{}}}}],"mets.amdSec":[{"mets.rightsMD":[{"mets.mdWrap":{"mets.xmlData":{"rights.RightsDeclarationMD":{}}}}]}],"mets.fileSec":{"mets.fileGrp":[{}]},"mets.structMap":[{TYPE:"PHYSICAL","mets.div":{TYPE:"FOLDER",LABEL:"FisicaMap"}}]}};const He={class:"flex h-full"},Ye={class:"w-sidebar-width"},Be={key:0,class:"w-[calc(100%-var(--sidebar-width))] flex justify-center items-center text-primary"},ze=a("svg",{role:"status",class:"mr-2 w-8 h-8 text-border animate-spin fill-primary",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),a("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})],-1),Fe=[ze],Ge={key:1,class:"w-[calc(100%-var(--sidebar-width))]"},We={key:0,class:"overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center flex"},Je={class:"relative my-6 mx-auto w-full h-full max-w-md max-h-48"},qe={class:"border-0 rounded shadow relative flex flex-col w-full h-full bg-white outline-none focus:outline-none"},Ke={class:"flex items-center justify-center p-4"},Xe={class:"text-xl"},Ze={class:"relative p-4 flex-auto overflow-y-auto flex items-center justify-center text-base text-[15px]"},Qe={class:"flex items-center justify-center p-4"},et={key:1,class:"opacity-25 fixed inset-0 z-40 bg-black"},tt={setup(e){const i=ne().appContext.config.globalProperties.emitter;i.on("publish",()=>{p(null,!0)});const r=$(!0),s=$(null),l=$(null);let o;const c=async()=>{let m=window.METS_ID||"CNMD_0000230128_m_20220427161639";m=encodeURIComponent(m);let h=`${A.appBaseUrl}rest/metsdata?id=${m}`,u;try{if(u=await fetch(h),!u.ok)throw new Error;u=await u.json(),s.value=Ce(u,$e),o=JSON.parse(JSON.stringify(s.value))}catch{l.value={title:"Attenzione!",message:"Errore durante il caricamento dati"};return}r.value=!1};ce(()=>{window.addEventListener("beforeunload",x)}),ue(()=>{window.removeEventListener("beforeunload",x)}),me(async()=>{await c()});function x(m){JSON.stringify(o)!==JSON.stringify(s.value)&&(m.preventDefault(),m.returnValue="")}async function p(m,h){console.log(s.value),r.value=!0;try{let u=De(s.value,J);if(i.emit("check-data",{check:!0}),u)throw new Error("Dati incompleti");let f=`${A.appBaseUrl}rest/validate/mets`,b=await fetch(f,{method:"POST",body:JSON.stringify(s.value),cache:"no-cache",headers:new Headers({"Content-Type":"text/plain"})});if(b=await b.json(),b.status!="OK")throw new Error;if(!!b.errors.length)throw new Error("Errore nell'inserimento dati");if(f=h?`${A.appBaseUrl}rest/metsdataAndPublish`:`${A.appBaseUrl}rest/metsdata`,b=await fetch(f,{method:"POST",body:JSON.stringify(s.value),cache:"no-cache",headers:new Headers({"Content-Type":"application/json"})}),b=await b.json(),b.stato!==0)throw new Error(b.messaggio)}catch(u){l.value={title:"Attenzione!",message:u.message||"Errore durante il salvataggio dei dati"},r.value=!1;return}o=s.value,r.value=!1,h?window.parent.postMessage(JSON.stringify({type:"publish"}),"*"):l.value={title:"Successo!",message:"Dati salvati correttamente"}}return(m,h)=>{var u,f;return d(),n(g,null,[a("div",He,[a("div",Ye,[y(Pe,{"tree-data":H(Ue)},null,8,["tree-data"])]),r.value?(d(),n("div",Be,Fe)):(d(),n("div",Ge,[y(H(he),{structure:H(J),data:s.value},null,8,["structure","data"])]))]),a("div",{class:"absolute bottom-0 left-0 right-0 flex justify-center border-b-4 border-primary"},[a("button",{onClick:p,class:"bg-primary hover:shadow text-white font-semibold py-2 px-4 w-32 font-semibold uppercase"}," salva ")]),l.value?(d(),n("div",We,[a("div",Je,[a("div",qe,[a("div",Ke,[a("span",Xe,S((u=l.value)==null?void 0:u.title),1)]),a("div",Ze,S((f=l.value)==null?void 0:f.message),1),a("div",Qe,[a("button",{class:"text-primary bg-transparent border border-solid border-primary font-semibold uppercase text-sm px-6 py-2 outline-none focus:outline-none mr-1 ease-linear transition-all duration-150 hover:bg-primary hover:text-white active:bg-primary",type:"button",onClick:h[0]||(h[0]=b=>l.value=null)},"OK")])])])])):_("",!0),l.value?(d(),n("div",et)):_("",!0)],64)}}},lt={},st={xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-plus",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},it=a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),at=a("line",{x1:"12",y1:"5",x2:"12",y2:"19"},null,-1),rt=a("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1),ot=[it,at,rt];function dt(e,t){return d(),n("svg",st,ot)}var te=I(lt,[["render",dt]]);const nt={},ct={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},ut=a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1),mt=[ut];function ht(e,t){return d(),n("svg",ct,mt)}var j=I(nt,[["render",ht]]);const pt={},ft={xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-x",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},yt=a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),bt=a("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),gt=a("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1),vt=[yt,bt,gt];function xt(e,t){return d(),n("svg",ft,vt)}var le=I(pt,[["render",xt]]);const _t={components:{PlusIcon:te,TrashIcon:j,XIcon:le},props:{structure:Object,data:Object},data(){return{section:this.structure[`mets.${this.$route.params.id}`],model:this.getModel(this.$route.params.id),route:this.$route.params.id,showModal:!1,loading:!1,media:[],selected:[],isEditing:!0}},computed:{},updated(){},mounted(){console.log("mounted")},methods:{preventNav(e){e.preventDefault(),e.returnValue=""},getModel(e){var t,i;switch(e){case"dmdSec":return this.data["mets.mets"]["mets.dmdSec"].find(m=>m.hasOwnProperty("mets.mdWrap")&&m["mets.mdWrap"].hasOwnProperty("mets.xmlData")&&m["mets.mdWrap"]["mets.xmlData"].hasOwnProperty("mods.mods"))["mets.mdWrap"]["mets.xmlData"]["mods.mods"];case"amdSec":return this.data["mets.mets"]["mets.amdSec"].find(m=>m.hasOwnProperty("mets.rightsMD"))["mets.rightsMD"][0]["mets.mdWrap"]["mets.xmlData"]["rights.RightsDeclarationMD"];case"fileSec":let r={},s,l;return Object.keys(this.structure["mets.fileSec"]).forEach(m=>{r[m]=[],s=this.data["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"].find(h=>h.USE===m),s&&(s=s["mets.fileGrp"].find(h=>h.USE==="HIGH")||s["mets.fileGrp"][0],s==null||s["mets.file"].forEach(h=>{var u;l={id:h.ID,thumbnail:m==="IMAGE"?`${A.appBaseUrl}${h["mets.FLocat"][0]["xlink.href"]}`:`${A.appBaseUrl}${A.thumbnail[m]}`},s=this.data["mets.mets"]["mets.structMap"].find(f=>f.TYPE==="PHYSICAL"),s=((u=s["mets.div"])==null?void 0:u["mets.div"])||[],h=s.find(f=>f["mets.fptr"][0].FILEID===l.id),h&&r[m].push(k(k({},l),h))}))}),r;case"structMap":let o={},c;Object.keys(this.structure["mets.fileSec"]).forEach(m=>{c=this.data["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"].find(h=>h.USE===m),c&&(c=c["mets.fileGrp"].find(h=>h.USE==="HIGH")||c["mets.fileGrp"][0],c==null||c["mets.file"].forEach(h=>o[h.ID]=m==="IMAGE"?`${A.appBaseUrl}${h["mets.FLocat"][0]["xlink.href"]}`:`${A.appBaseUrl}${A.thumbnail[m]}`))});let x=((i=(t=this.data["mets.mets"]["mets.structMap"].find(m=>m.TYPE==="LOGICAL"))==null?void 0:t["mets.div"])==null?void 0:i["mets.div"])||[];console.log(this.data["mets.mets"]["mets.structMap"]);let p=[];return B(p,x,0,[]),{PHYSICAL:this.data["mets.mets"]["mets.structMap"].find(m=>m.TYPE==="PHYSICAL"),LOGICAL:p,thumbnails:o};default:return this.data["mets.mets"][`mets.${e}`]}},updateLabel(e){const{id:t,value:i}=e;this.data["mets.mets"]["mets.structMap"].map(r=>X(r["mets.div"],t,"LABEL",i))},updateLogical(e){if(!e.length)this.data["mets.mets"]["mets.structMap"]=this.data["mets.mets"]["mets.structMap"].filter(t=>t.TYPE!=="LOGICAL");else{let t=[];Z(t,e,0),t.sort((i,r)=>i.ORDER>r.ORDER?1:r.ORDER>i.ORDER?-1:0),this.data["mets.mets"]["mets.structMap"].find(i=>i.TYPE==="LOGICAL")||this.data["mets.mets"]["mets.structMap"].push({TYPE:"LOGICAL","mets.div":{TYPE:"FOLDER",LABEL:"LogicaMap"}}),this.data["mets.mets"]["mets.structMap"].find(i=>i.TYPE==="LOGICAL")["mets.div"]["mets.div"]=t}},addMedia(){this.showModal=!0},async toggleModal(e){if(this.showModal=!this.showModal,this.showModal){this.loading=!0;let t=window.METS_ID||"cardano_20e849512d41f1a284743ecd3b3ee054_";t=encodeURIComponent(t);let i=`${A.appBaseUrl}rest/vfs/resources?idContainer=${t}&start=0&rows=1000`,r=await(await fetch(i)).json(),s;r.map(l=>{s=this.getMediaType(l.contentType),l.thumbnail=s==="IMAGE"?`${A.appBaseUrl}${l.preview}`:`${A.appBaseUrl}${A.thumbnail[s]}`}),this.media=r,this.loading=!1}else if(e&&this.selected.length){let t,i,r,s;this.selected.forEach(l=>{t={ID:l.id,MIMETYPE:l.contentType,SIZE:l.fileSize,CHECKSUM:l.md5?"MD5":"",CHECKSUMTYPE:l.md5||"","mets.FLocat":[{LOCTYPE:"OTHER",OTHERLOCTYPE:"SYSTEM","xlink.href":l.url}]},r=this.getMediaType(l.contentType),s=this.data["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"].find(o=>o.USE===r),s||this.data["mets.mets"]["mets.fileSec"]["mets.fileGrp"][0]["mets.fileGrp"].push({USE:r,"mets.fileGrp":[{USE:"HIGH","mets.file":[]}]}),s=s["mets.fileGrp"].find(o=>o.USE==="HIGH")||s["mets.fileGrp"][0],s["mets.file"]||(s["mets.file"]=[]),s["mets.file"].push(t),i={TYPE:"FILE",ORDER:-1,LABEL:"","mets.fptr":[{FILEID:l.id}]},this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"]||(this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"]=[]),this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"].push(i)}),this.data["mets.mets"]["mets.structMap"].find(l=>l.TYPE==="PHYSICAL")["mets.div"]["mets.div"].map((l,o)=>l.ORDER=o+1),this.model=this.getModel("fileSec")}this.selected=[]},toggleMedia(e){let t=this.selected.findIndex(i=>i.id===e.id);t===-1?this.selected.push(e):this.selected.splice(t,1),console.log(this.selected)},getMediaType(e){let t;switch(e.split("/")[0]){case"image":t="IMAGE";break;case"audio":t="AUDIO";break;case"video":t="VIDEO";break;default:t="TEXT"}return t},findMedia(e){let t=this.getMediaType(e.contentType);return this.model[t].find(i=>i.id===e.id)},removeMedia(e,t){var s,l;this.model[t]=this.model[t].filter(o=>o.id!==e.id),this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"]&&(this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"]=this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"].filter(o=>o["mets.fptr"][0].FILEID!==e.id)),this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="PHYSICAL")["mets.div"]["mets.div"];let i=((l=(s=this.data["mets.mets"]["mets.structMap"].find(o=>o.TYPE==="LOGICAL"))==null?void 0:s["mets.div"])==null?void 0:l["mets.div"])||[],r=[];B(r,i,0,[],e.id),this.updateLogical(r)},load(e){this.loading=!1,this.data["mets.mets"]["mets.dmdSec"].find(t=>t.hasOwnProperty("mets.mdWrap")&&t["mets.mdWrap"].hasOwnProperty("mets.xmlData")&&t["mets.mdWrap"]["mets.xmlData"].hasOwnProperty("mods.mods"))["mets.mdWrap"]["mets.xmlData"]["mods.mods"]=k(k({},this.model),e["mods.mods"]),this.model=this.getModel("dmdSec"),this.section={},this.$nextTick(()=>{this.section=this.structure["mets.dmdSec"]})}},watch:{$route(e,t){this.section=this.structure[`mets.${this.$route.params.id}`],this.model=this.getModel(this.$route.params.id),this.route=e.params.id}}},F=e=>(pe("data-v-59bad673"),e=e(),fe(),e),wt={class:"p-4 h-full overflow-auto"},It={class:"border-b border-border pb-2 mb-4"},kt={class:"text-2xl"},At={key:0},Mt={key:1,class:"h-[calc(100%-3.5rem-1px)]"},Et={key:2,class:"h-[calc(100%-3.5rem-1px)]"},Tt={class:"flex flex-wrap"},St={class:"flex absolute top-0 right-0 h-[35px]"},Ct=z("Aggiungi media "),Dt={key:0,class:"overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center flex"},Ot={class:"relative my-6 mx-auto w-11/12 h-5/6"},Lt={class:"border-0 rounded shadow relative flex flex-col w-full h-full bg-white outline-none focus:outline-none"},Nt={class:"flex items-center justify-between p-4 border-b border-border rounded-t"},Vt=F(()=>a("span",{class:"text-xl"},"Aggiungi media",-1)),jt=F(()=>a("span",{class:"bg-transparent text-[1.5rem] block outline-none focus:outline-none"},"\xD7",-1)),Rt=[jt],Pt={class:"relative p-4 flex-auto overflow-y-auto"},Ut={class:"flex flex-wrap"},$t=["onClick"],Ht={class:"flex items-center justify-end p-4 border-t border-solid border-border rounded-b"},Yt={key:1,class:"opacity-25 fixed inset-0 z-40 bg-black"},Bt={key:2,class:"flex justify-center items-center text-primary fixed inset-0 z-50"},zt=F(()=>a("svg",{role:"status",class:"mr-2 w-8 h-8 text-border animate-spin fill-primary",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),a("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})],-1)),Ft=[zt];function Gt(e,t,i,r,s,l){const o=v("MetsWrapper"),c=v("MetsSortable"),x=v("MetsLogical"),p=v("tab"),m=v("tabs"),h=v("MetsCard"),u=v("PlusIcon");return d(),n(g,null,[a("div",wt,[a("div",It,[a("h1",kt,"Sezione "+S(e.$route.params.id),1)]),s.route==="metsHdr"||s.route==="amdSec"||s.route==="dmdSec"?(d(),n("div",At,[(d(!0),n(g,null,M(s.section,(f,b)=>(d(),n("div",{key:b,class:"mb-5 mx-5"},[y(o,{_key:b,value:f,model:s.model,onBeforeLoad:t[0]||(t[0]=C=>s.loading=!0),onLoad:l.load},null,8,["_key","value","model","onLoad"])]))),128))])):s.route==="structMap"?(d(),n("div",Mt,[y(m,{class:"tabs",options:{useUrlFragment:!1}},{default:L(()=>[(d(!0),n(g,null,M(s.section,(f,b)=>(d(),D(p,{class:"h-full pt-5",name:f,key:b},{default:L(()=>[b==="PHYSICAL"?(d(),D(c,{key:0,list:s.model[b]["mets.div"]["mets.div"]||[],thumbnails:s.model.thumbnails,onUpdateOrder:C=>s.model[b]["mets.div"]["mets.div"]=C},null,8,["list","thumbnails","onUpdateOrder"])):(d(),D(x,{key:1,struct:s.model[b],media:s.model.PHYSICAL["mets.div"]["mets.div"]||[],thumbnails:s.model.thumbnails,onUpdateStruct:l.updateLogical},null,8,["struct","media","thumbnails","onUpdateStruct"]))]),_:2},1032,["name"]))),128))]),_:1})])):(d(),n("div",Et,[y(m,{class:"tabs",options:{useUrlFragment:!1}},{default:L(()=>[(d(!0),n(g,null,M(s.section,(f,b)=>(d(),D(p,{class:"h-full pt-5",name:f,key:b},{default:L(()=>[a("div",Tt,[(d(!0),n(g,null,M(s.model[b],C=>(d(),n("div",{key:C.id,class:"m-1"},[y(h,{file:C,onUpdateLabel:l.updateLabel,onRemoveMedia:se=>l.removeMedia(se,b)},null,8,["file","onUpdateLabel","onRemoveMedia"])]))),128))])]),_:2},1032,["name"]))),128))]),_:1}),a("div",St,[a("a",{class:"flex items-center mr-4 text-primary font-semibold text-[13px]",onClick:t[1]||(t[1]=(...f)=>l.toggleModal&&l.toggleModal(...f))},[y(u,{class:"h-4"}),Ct])])]))]),s.showModal?(d(),n("div",Dt,[a("div",Ot,[a("div",Lt,[a("div",Nt,[Vt,a("button",{class:"ml-auto bg-transparent border-0 text-black float-right hover:text-primary text-xl leading-none font-semibold outline-none focus:outline-none",onClick:t[2]||(t[2]=(...f)=>l.toggleModal&&l.toggleModal(...f))},Rt)]),a("div",Pt,[a("div",Ut,[(d(!0),n(g,null,M(s.media,f=>(d(),n(g,{key:f.id},[l.findMedia(f)?_("",!0):(d(),n("div",{key:0,class:w(["m-1 cursor-pointer",{"outline outline-2 outline-primary":s.selected.findIndex(b=>b.id===f.id)>-1}]),onClick:b=>l.toggleMedia(f)},[y(h,{file:f,options:{enableEdit:!1,enableRemove:!1}},null,8,["file"])],10,$t))],64))),128))])]),a("div",Ht,[a("button",{class:"text-black hover:text-primary background-transparent font-semibold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",type:"button",onClick:t[3]||(t[3]=(...f)=>l.toggleModal&&l.toggleModal(...f))},"Annulla"),a("button",{class:w(["text-primary bg-transparent border border-solid border-primary font-semibold uppercase text-sm px-6 py-2 outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",{"opacity-50 cursor-not-allowed pointer-events-none":!s.selected.length,"hover:bg-primary hover:text-white active:bg-primary":s.selected.length}]),type:"button",onClick:t[4]||(t[4]=f=>l.toggleModal(!0))},"Conferma",2)])])])])):_("",!0),s.showModal?(d(),n("div",Yt)):_("",!0),s.loading?(d(),n("div",Bt,Ft)):_("",!0)],64)}var Wt=I(_t,[["render",Gt],["__scopeId","data-v-59bad673"]]);const Jt=ye({history:be("/console/mets-editor/"),routes:[{path:"/mets/:id",name:"mets",component:Wt},{path:"/:catchAll(.*)",redirect:"/mets/metsHdr"}]}),qt={emits:["update"],props:{_key:String,value:Object,model:Object,forceUpdate:Boolean,id:String},data(){return{data:Array.isArray(this.model)?this.model[0]:this.model,__key:this.value.key||this._key}},methods:{update(e){let{key:t,value:i}=e;Array.isArray(this.model)?this.model[0][t]=i:this.model[t]=i,this.forceUpdate&&this.$emit("update",{key:this.id,value:this.model})},del(e){Array.isArray(this.model)?delete this.model[0][e]:delete this.model[e]}}};function Kt(e,t,i,r,s,l){return d(),D(ge("mets-"+i.value.type),{id:s.__key,field:i.value,model:s.data,onUpdate:l.update,onDelete:l.del},null,8,["id","field","model","onUpdate","onDelete"])}var Xt=I(qt,[["render",Kt]]);const Zt={},Qt={xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-cloud-download",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},el=a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),tl=a("path",{d:"M19 18a3.5 3.5 0 0 0 0 -7h-1a5 4.5 0 0 0 -11 -2a4.6 4.4 0 0 0 -2.1 8.4"},null,-1),ll=a("line",{x1:"12",y1:"13",x2:"12",y2:"22"},null,-1),sl=a("polyline",{points:"9 19 12 22 15 19"},null,-1),il=[el,tl,ll,sl];function al(e,t){return d(),n("svg",Qt,il)}var rl=I(Zt,[["render",al]]);const ol={emits:["update","delete","before-load","load"],components:{DownloadIcon:rl},props:{id:String,field:Object,model:Object},data(){return{invalid:this.check(null,ee())}},computed:{inputVal:{get(){let e=this.model[this.id]?this.field.singleArray?this.model[this.id][0]:this.model[this.id]:"";return this.field.objectValue?e.value:e},set(e){var t;if(e){if(this.field.objectValue&&(e={value:e},this.field.otherAttributes&&(e=k(k({},this.field.otherAttributes),e))),this.field.singleArray){let r=this.field.objectValue?k({},e):e;(t=this.model[this.id])==null||t.splice(0,1,r),e=this.model[this.id]||[e]}let i={key:this.id,value:e};this.$emit("update",i)}else this.field.disableDelete||this.$emit("delete",this.id)}}},created(){this.emitter.on("check-data",e=>{this.check(null,e.check)})},methods:{check(e,t){this.$nextTick(()=>{this.invalid=t?this.field.mandatory&&!this.inputVal:!1})},async getData(){this.$emit("before-load");let e=`${A.appBaseUrl}${this.field.url.replace(":value",this.inputVal)}`,t=await(await fetch(e)).json();this.$emit("load",t)}}},dl=["disabled"],nl=["disabled"];function cl(e,t,i,r,s,l){const o=v("DownloadIcon");return d(),n("div",{class:w(["flex",{"h-[30px]":!i.field.textarea,"h-[90px]":i.field.textarea}])},[a("div",{class:w(["flex pr-2",{"w-1/5 justify-end":!i.field.labelLeft,"items-center":!i.field.textarea,"items-start":i.field.textarea}])},[a("span",{class:w({"font-semibold":i.field.mandatory})},S(i.field.label),3)],2),a("div",{class:w(["flex justify-center",{"w-4/5":!i.field.labelLeft,"w-3/6":i.field.labelLeft}])},[i.field.textarea?T((d(),n("textarea",{key:0,"onUpdate:modelValue":t[0]||(t[0]=c=>l.inputVal=c),class:w(["w-11/12 h-full border border-border px-[5px] focus:outline-0 focus:border-primary resize-none",{"border-l-[3px] border-l-red-500":s.invalid}]),onFocus:t[1]||(t[1]=(...c)=>l.check&&l.check(...c)),onBlur:t[2]||(t[2]=c=>l.check(c,!0)),disabled:i.field.readonly},null,42,dl)),[[O,l.inputVal]]):T((d(),n("input",{key:1,"onUpdate:modelValue":t[3]||(t[3]=c=>l.inputVal=c),class:w(["w-11/12 h-full border border-border px-[5px] focus:outline-0 focus:border-primary",{"border-l-[3px] border-l-red-500":s.invalid}]),onFocus:t[4]||(t[4]=(...c)=>l.check&&l.check(...c)),onBlur:t[5]||(t[5]=c=>l.check(c,!0)),type:"text",disabled:i.field.readonly,pattern:"\\((\\d{4}(/\\d{4})?((\\d{2})(/(\\d{2}|\\d{6}))?((\\d{2})(/\\d{2})?)?)?)?\\)((\\+|\\*)?|(\\d{1,4}(:(\\d{1,4})(/\\d{1,4})?(\\+|\\*)?)?(:(\\d{1,4})(/\\d{1,4})?(\\+|\\*)?)?(:(\\d{1,4})(/\\d{1,4})?(\\+|\\*)?)?)?)?"},null,42,nl)),[[O,l.inputVal]]),i.field.url?(d(),n("a",{key:2,onClick:t[6]||(t[6]=c=>l.getData()),class:"absolute right-[10px] top-[5px]"},[y(o,{class:"h-5"})])):_("",!0)],2)],2)}var ul=I(ol,[["render",cl]]);const ml={emits:["update","delete","before-load","load"],components:{TrashIcon:j},props:{id:String,field:Object,model:Object},data(){return{data:this.model[this.id]||JSON.parse(JSON.stringify(this.field.default))}},methods:{update(e){this.$emit("update",e)},addRecord(){let e={};Object.keys(this.field.child).forEach(t=>{e[t]=this.field.child[t].default!==void 0?JSON.parse(JSON.stringify(this.field.child[t].default)):this.field.child[t].default}),e=k(k({},this.field.otherAttributes),e),this.data.push(e),this.update({key:this.id,value:this.data})},removeRecord(e){this.data.splice(e,1);let t=JSON.parse(JSON.stringify(this.data));this.data=[],this.$nextTick(()=>{this.data=t,this.update({key:this.id,value:this.data})})},checkKey(e){return this.field.arrayObjectModel.indexOf(e)>-1},getModel(e){let t={[e]:""},i=this.data.find(r=>r.type===e);return i&&(t[i.type]=i.value),t},updateArrayObject(e){let{key:t,value:i}=e;this.data=this.data.filter(r=>r.type!==t),this.data.push({type:t,value:i}),this.$emit("update",{key:this.id,value:this.data})},deleteArrayObject(e){this.data=this.data.filter(t=>t.type!==e),this.$emit("update",{key:this.id,value:this.data})},getOther(){return this.data.filter(e=>this.field.arrayObjectModel.indexOf(e.type)===-1)},addArrayObjectRecord(){this.data.push({type:"",value:""}),this.$emit("update",{key:this.id,value:this.data})},removeArrayObjectRecord(e,t){console.log(e,t);let i=0,r=!1;this.getOther().forEach((o,c)=>{!r&&o.type===e.type&&o.value===e.value&&(i++,c===t&&(r=!0))});let s;i>1?this.data.forEach((o,c)=>{i>0&&o.type===e.type&&o.value===e.value&&(i--,i===0&&(s=c))}):s=this.data.findIndex(o=>o.type===e.type&&o.value===e.value),this.data.splice(s,1);let l=JSON.parse(JSON.stringify(this.data));this.data=[],this.$nextTick(()=>{this.data=l,this.$emit("update",{key:this.id,value:this.data})})},beforeLoad(){this.$emit("before-load")},load(e){this.$emit("load",e)}}},hl={key:0,class:"px-2.5 text-lg text-primary"},pl={class:"w-[30px] flex flex-col items-end"},fl=["onClick"],yl={class:"w-[calc(100%-30px)]"},bl={key:2,class:"flex"},gl={key:0,class:"w-[30px] flex flex-col items-end"},vl={class:"px-2.5 text-lg text-primary"},xl={class:"w-[30px] flex flex-col items-end"},_l=["onClick"],wl={class:"w-[calc(100%-30px)]"};function Il(e,t,i,r,s,l){const o=v("TrashIcon"),c=v("MetsWrapper"),x=v("MetsText");return d(),n("fieldset",{class:w({"border-2 border-border p-2.5":!i.field.hidden})},[i.field.hidden?_("",!0):(d(),n("legend",hl,S(i.field.label),1)),i.field.multi?(d(),n(g,{key:1},[(d(!0),n(g,null,M(s.data,(p,m)=>T((d(),n("div",{key:m,class:"mb-5 border-l-4 flex"},[a("div",pl,[a("a",{onClick:h=>l.removeRecord(m)},[y(o,{class:"h-5"})],8,fl)]),a("div",yl,[(d(!0),n(g,null,M(i.field.child,(h,u)=>(d(),n("div",{key:u,class:"mb-5 ml-5"},[y(c,{_key:u,value:h,model:p,onUpdate:l.update},null,8,["_key","value","model","onUpdate"])]))),128))])])),[[Y,!i.field.filter||i.field.filter(p)]])),128)),a("button",{onClick:t[0]||(t[0]=(...p)=>l.addRecord&&l.addRecord(...p)),class:"bg-transparent hover:bg-primary text-primary font-semibold hover:text-white py-2 px-4 border border-primary hover:border-transparent"}," Aggiungi un record ")],64)):(d(),n("div",bl,[i.field.hidden?_("",!0):(d(),n("div",gl)),a("div",{class:w({"w-[calc(100%-30px)]":!i.field.hidden,"w-full":i.field.hidden,"flex flex-wrap":i.field.rowDirectChildren})},[(d(!0),n(g,null,M(i.field.child,(p,m,h)=>(d(),n("div",{key:m,class:w({"ml-5":!i.field.hidden,"mb-5":h!=Object.keys(i.field.child).length-1||i.field.rowDirectChildren})},[i.field.arrayObjectModel?(d(),n(g,{key:1},[p.type==="text"&&l.checkKey(m)?(d(),D(x,{key:0,id:m,field:p,model:l.getModel(m),onUpdate:l.updateArrayObject,onDelete:l.deleteArrayObject,onBeforeLoad:l.beforeLoad,onLoad:l.load},null,8,["id","field","model","onUpdate","onDelete","onBeforeLoad","onLoad"])):p.type==="group"?(d(),n(g,{key:1},[a("legend",vl,S(p.label),1),p.multi?(d(),n(g,{key:0},[(d(!0),n(g,null,M(l.getOther(),(u,f)=>(d(),n("div",{key:f,class:"mb-5 border-l-4 flex"},[a("div",xl,[a("a",{onClick:b=>l.removeArrayObjectRecord(u,f)},[y(o,{class:"h-5"})],8,_l)]),a("div",wl,[(d(!0),n(g,null,M(p.child,(b,C)=>(d(),n("div",{key:C,class:"mb-5 ml-5"},[y(c,{_key:C,value:b,model:u},null,8,["_key","value","model"])]))),128))])]))),128)),a("button",{onClick:t[1]||(t[1]=(...u)=>l.addArrayObjectRecord&&l.addArrayObjectRecord(...u)),class:"bg-transparent hover:bg-primary text-primary font-semibold hover:text-white py-2 px-4 border border-primary hover:border-transparent"}," Aggiungi un record ")],64)):(d(),n(g,{key:1},[],64))],64)):_("",!0)],64)):(d(),D(c,{key:0,_key:m,value:p,model:s.data,"force-update":i.field.forceUpdate,id:i.id,onUpdate:l.update},null,8,["_key","value","model","force-update","id","onUpdate"]))],2))),128))],2)]))],2)}var kl=I(ml,[["render",Il]]);const Al={emits:["update","delete"],components:{"v-select":K},props:{id:String,field:Object,model:Object},data(){return{data:this.model[this.id],invalid:this.check(null,ee())}},computed:{options(){let e=JSON.parse(JSON.stringify(this.field.values));return this.field.mandatory||e.unshift("-"),e},selectVal:{get(){var e;return this.data=(this.field.singleArray?this.model[this.id]?this.model[this.id][0]:"":this.model[this.id])||"",this.field.objectValue?(e=this.data)==null?void 0:e.value:this.data},set(e){e==="-"&&(e=""),e!=="OTHER"&&(this.inputVal=""),this.field.objectValue&&(e={value:e}),this.data=e;let t=this.field.singleArray?{key:this.id,value:[e]}:{key:this.id,value:e};this.$emit("update",t),this.$nextTick(()=>{})}},inputVal:{get(){return this.model[this.field.otherAttribute]},set(e){e?this.$emit("update",{key:this.field.otherAttribute,value:e}):this.$emit("delete",this.field.otherAttribute)}}},created(){this.emitter.on("check-data",e=>{this.check(null,e.check)})},methods:{check(e,t){this.$nextTick(()=>{var r;let i=this.field.objectValue?(r=this.data)==null?void 0:r.value:this.data;this.invalid=t?this.field.mandatory&&!i:!1})}}},Ml={class:"flex h-[30px]"},El={class:"w-1/5 flex items-center justify-end pr-2"},Tl={class:"w-4/5 flex justify-center"},Sl={key:0,class:"flex h-[30px] mt-2"},Cl=a("div",{class:"w-1/5 flex items-center justify-end pr-2"},null,-1),Dl={class:"w-4/5 flex justify-center"};function Ol(e,t,i,r,s,l){const o=v("v-select");return d(),n(g,null,[a("div",Ml,[a("div",El,[a("span",{class:w({"font-semibold":i.field.mandatory})},S(i.field.label),3)]),a("div",Tl,[y(o,{modelValue:l.selectVal,"onUpdate:modelValue":t[0]||(t[0]=c=>l.selectVal=c),options:l.options,clearable:!1,class:w(["select w-11/12 h-full p-0",{"border-l-[3px] border-l-red-500":s.invalid}]),"onSearch:focus":l.check,"onSearch:blur":t[1]||(t[1]=c=>l.check(c,!0))},null,8,["modelValue","options","class","onSearch:focus"])])]),l.selectVal==="OTHER"?(d(),n("div",Sl,[Cl,a("div",Dl,[T(a("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>l.inputVal=c),class:"w-11/12 h-full border border-border px-[5px] focus:outline-0 focus:border-primary",type:"text"},null,512),[[O,l.inputVal]])])])):_("",!0)],64)}var Ll=I(Al,[["render",Ol]]);const Nl={emits:["update","delete"],props:{id:String,field:Object,model:Object},data(){return{other:!1}},computed:{checkVal:{get(){return this.model[this.id]},set(e){this.other=this.id==="OTHER"&&e,this.$emit("update",{key:this.id,value:e})}},inputVal:{get(){return this.model[this.field.otherAttribute]},set(e){e?this.$emit("update",{key:this.field.otherAttribute,value:e}):this.$emit("delete",this.field.otherAttribute)}}}},Vl={class:"flex items-center pr-2"},jl={class:"flex items-center"},Rl=["disabled"];function Pl(e,t,i,r,s,l){return d(),n("div",{class:w(["flex h-[30px]",{"mr-8":i.id!=="OTHER"}])},[a("div",Vl,[a("span",null,S(i.field.label||i.id),1)]),a("div",jl,[T(a("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.checkVal=o),type:"checkbox",disabled:i.field.readonly},null,8,Rl),[[ve,l.checkVal]]),s.other?T((d(),n("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=o=>l.inputVal=o),class:"w-full h-full ml-7 border border-border px-[5px] focus:outline-0 focus:border-primary",type:"text"},null,512)),[[O,l.inputVal]]):_("",!0)])],2)}var Ul=I(Nl,[["render",Pl]]);const $l={},Hl={xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-pencil",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Yl=a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),Bl=a("path",{d:"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"},null,-1),zl=a("line",{x1:"13.5",y1:"6.5",x2:"17.5",y2:"10.5"},null,-1),Fl=[Yl,Bl,zl];function Gl(e,t){return d(),n("svg",Hl,Fl)}var Wl=I($l,[["render",Gl]]);const Jl={},ql={xmlns:"http://www.w3.org/2000/svg",class:"icon icon-tabler icon-tabler-check",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Kl=a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),Xl=a("path",{d:"M5 12l5 5l10 -10"},null,-1),Zl=[Kl,Xl];function Ql(e,t){return d(),n("svg",ql,Zl)}var es=I(Jl,[["render",Ql]]);const ts={emits:["update-label","remove-media"],components:{PencilIcon:Wl,CheckIcon:es,TrashIcon:j},props:{file:Object,options:Object},data(){return{edit:!1}},computed:{_options(){return k({enableEdit:!0,enableRemove:!0},this.options)}},methods:{enableEdit(){this.edit=!0,this.$nextTick(()=>{this.$refs.label.focus()})},confirm(){this.edit=!1,this.$emit("update-label",{id:this.file.id,value:this.file.LABEL})},removeMedia(){this.$emit("remove-media",{id:this.file.id})}}},ls={class:"flex justify-center overflow-hidden"},ss={class:"w-52 h-48"},is={class:"flex justify-center items-center h-[calc(100%-20px)] bg-light border border-border border-b-0"},as=["src","alt"],rs={key:0,class:"flex items-center justify-between h-[20px] bg-dark text-white"},os={class:"px-[5px] line-clamp-1"},ds={class:"flex"},ns={key:1,class:"flex items-center justify-between h-[20px]"};function cs(e,t,i,r,s,l){var p,m;const o=v("PencilIcon"),c=v("TrashIcon"),x=v("CheckIcon");return d(),n("div",ls,[a("div",ss,[a("div",is,[a("img",{class:"max-h-full max-w-full",src:`${i.file.thumbnail}`,alt:i.file.LABEL},null,8,as)]),s.edit?_("",!0):(d(),n("div",rs,[a("span",os,S(i.file.LABEL),1),a("div",ds,[(p=l._options)!=null&&p.enableEdit?(d(),n("a",{key:0,onClick:t[0]||(t[0]=(...h)=>l.enableEdit&&l.enableEdit(...h))},[y(o,{class:"h-[20px]"})])):_("",!0),(m=l._options)!=null&&m.enableRemove?(d(),n("a",{key:1,onClick:t[1]||(t[1]=(...h)=>l.removeMedia&&l.removeMedia(...h))},[y(c,{class:"h-[20px]"})])):_("",!0)])])),s.edit?(d(),n("div",ns,[T(a("input",{ref:"label","onUpdate:modelValue":t[2]||(t[2]=h=>i.file.LABEL=h),onKeyup:t[3]||(t[3]=xe((...h)=>l.confirm&&l.confirm(...h),["enter"])),class:"w-full h-full border border-border pl-[5px] pr-6 focus:outline-0 focus:border-primary",type:"text"},null,544),[[O,i.file.LABEL]]),a("a",{class:"absolute right-0",onClick:t[4]||(t[4]=(...h)=>l.confirm&&l.confirm(...h))},[y(x)])])):_("",!0)])])}var us=I(ts,[["render",cs]]);_e.mount(new we);const ms={emits:["update-order"],components:{draggable:Ie},props:{list:Array,thumbnails:Object},data(){return{_list:this.list.map(e=>U(k({},e),{thumbnail:this.thumbnails[e["mets.fptr"][0].FILEID]})),drag:!1,selected:void 0}},methods:{getItemKey(e){return e["mets.fptr"][0].FILEID},checkMove(e){},onStart(e){this.drag=!0},onEnd(e,t){if(this.drag=!1,e.oldIndicies.length){let r=e.oldIndicies.map(l=>l.multiDragElement.id).reverse(),s=this.list.map(l=>l["mets.fptr"][0].FILEID);s=s.filter(l=>r.indexOf(l)===-1),r.forEach(l=>s.splice(e.newIndex,0,l)),this._list.sort((l,o)=>s.indexOf(l["mets.fptr"][0].FILEID)-s.indexOf(o["mets.fptr"][0].FILEID))}this._list.map((r,s)=>r.ORDER=s+1);let i=JSON.parse(JSON.stringify(this._list));i.map(r=>(delete r.thumbnail,r)),this.$emit("update-order",i)},onChange(e){},onUpdate(e){}}},hs=["id"];function ps(e,t,i,r,s,l){const o=v("MetsCard"),c=v("draggable");return d(),D(c,{class:"flex flex-wrap",modelValue:s._list,"onUpdate:modelValue":t[0]||(t[0]=x=>s._list=x),onStart:l.onStart,onEnd:l.onEnd,onChange:l.onChange,onUpdate:l.onUpdate,"item-key":l.getItemKey,"ghost-class":"ghost","drag-class":"drag",move:l.checkMove,animation:"150","multi-drag":!0,"selected-class":"chosen"},{item:L(({element:x})=>[x.thumbnail?(d(),n("div",{key:0,class:"m-1 cursor-pointer",id:x["mets.fptr"][0].FILEID},[y(o,{file:x,options:{enableEdit:!1,enableRemove:!1}},null,8,["file"])],8,hs)):_("",!0)]),_:1},8,["modelValue","onStart","onEnd","onChange","onUpdate","item-key","move"])}var fs=I(ms,[["render",ps],["__scopeId","data-v-410f46f6"]]);const ys={emits:["update-struct"],components:{Tree:q,PlusIcon:te,TrashIcon:j,XIcon:le},props:{struct:Array,media:Array,thumbnails:Object},data(){return{treeDisplayData:this.struct,state:!1,selectedNode:void 0,showModal:!1,selectedMedia:[]}},computed:{_media(){return this.media.sort((e,t)=>e.ORDER>t.ORDER?1:t.ORDER>e.ORDER?-1:0).map(e=>U(k({},e),{thumbnail:this.thumbnails[e["mets.fptr"][0].FILEID]}))},treeStyles(){return{tree:{style:{width:"100%",height:"auto",maxHeight:"100%",overflowY:"visible",display:"inline-block",textAlign:"left"}},row:{style:{cursor:"pointer",width:"100%"},child:{style:{height:"auto"},class:"h-5",active:{style:{height:"auto"},class:"h-5 bg-primary opacity-70 selected"}}},addNode:{class:""},editNode:{class:""},deleteNode:{class:""},selectIcon:{class:"folder",style:{color:"var(--color-primary)"},active:{class:"folder-active",style:{}}},text:{style:{},class:"pl-6",active:{style:{color:"white","font-weight":600}}}}},treeOptions(){return{treeEvents:{},events:{selected:{state:!0,fn:e=>{this.selectNode(e.id)}},editableName:{state:!0,fn:e=>{this.selectNode(e.id)}}}}}},methods:{selectNode(e){this.$refs["logical-tree"].selectNode(e),this.selectedNode=this.$refs["logical-tree"].getSelectedNode()},addNode(e,t){if(this.state=!1,!this.treeDisplayData.length){this.treeDisplayData.push({id:1,text:"titolo",state:{checked:!1,selected:!0,expanded:!1},nodes:[],media:[]}),this.selectNode(1),this.updateStruct();return}let i=t?this.selectedNode:this.$refs["logical-tree"].findNode(this.selectedNode.parent),r=i?i.text.split(" "):this.treeDisplayData.length;r=r[r.length-1],r=isNaN(r)||isNaN(parseFloat(r))?"":r+".";let s=i?i.nodes.length+1:this.treeDisplayData.length+1,l={id:Math.floor(Math.random()*100),text:"titolo "+r+s,state:{checked:!1,selected:!1,expanded:!1},nodes:[],media:[]};i?(l.parent=i.id,i.nodes.push(l),i.state.expanded=!0):this.treeDisplayData.push(l),this.selectNode(l.id),this.updateStruct()},getParentNodes(e){return e?this.$refs["logical-tree"].findNode(e).nodes:this.treeDisplayData},deleteNode(){const t=this.$refs["logical-tree"].findNodePath(this.selectedNode.id).slice(-2,-1)[0];if(t===void 0){const i=this.$refs["logical-tree"].nodes.findIndex(r=>r.id!==this.selectedNode.id)-1;this.$refs["logical-tree"].nodes.splice(i,1)}else{const i=this.$refs["logical-tree"].findNode(t),r=i.nodes.findIndex(s=>s.id!==this.selectedNode.id)-1;i.nodes.splice(r,1)}this.selectedNode=void 0,this.updateStruct()},toggleDropdown(e){this.treeDisplayData.length?this.state=!this.state:this.addNode()},close(e){var t;(t=this.$refs.dropdown)!=null&&t.contains(e.target)||(this.state=!1)},updateName(e){const{key:t,value:i}=e;this.selectedNode[t]=i,this.updateStruct()},toggleModal(e){if(this.showModal=!this.showModal,this.showModal&&(this.selectedMedia=[]),e){let t;this.selectedMedia.forEach(i=>{t=this._media.find(r=>r["mets.fptr"][0].FILEID===i),t&&this.selectedNode.media.push(t)}),this.updateStruct()}this.selectedMedia=[]},toggleMedia(e){let t=this.selectedMedia.indexOf(e);t===-1?this.selectedMedia.push(e):this.selectedMedia.splice(t,1)},removeMedia(){this.selectedNode.media=this.selectedNode.media.filter(e=>this.selectedMedia.indexOf(e["mets.fptr"][0].FILEID)===-1),this.selectedMedia=[],this.updateStruct()},updateStruct(){this.$emit("update-struct",this.treeDisplayData)}},mounted(){document.addEventListener("click",this.close)},beforeDestroy(){document.removeEventListener("click",this.close)}},bs={class:"flex w-full h-full"},gs={class:"h-full w-1/6 overflow-y-scroll border-r border-border pr-4"},vs={class:"flex justify-between border-b border-border pb-1"},xs=a("span",{class:"font-medium"},"Indice",-1),_s={class:"flex items-center"},ws={class:"mr-1"},Is={ref:"dropdown",class:"flex justify-center"},ks={class:"dropdown relative"},As={class:"dropdown-menu min-w-max absolute bg-white text-base z-50 float-left py-2 list-none text-left border border-border mt-1 m-0 bg-clip-padding -right-1/2","aria-labelledby":"dropdownMenuButton2"},Ms={key:0,class:"h-full w-5/6 overflow-y-scroll pl-4"},Es={class:"flex justify-between border-b border-border mt-6"},Ts=a("span",null,"Contenuto",-1),Ss={class:"flex"},Cs=z("Associa media "),Ds=z("Rimuovi selezionati "),Os={class:"relative py-4 flex-auto"},Ls={class:"flex flex-wrap"},Ns=["onClick"],Vs={key:0,class:"overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center flex"},js={class:"relative my-6 mx-auto w-11/12 h-5/6"},Rs={class:"border-0 rounded shadow relative flex flex-col w-full h-full bg-white outline-none focus:outline-none"},Ps={class:"flex items-center justify-between p-4 border-b border-border rounded-t"},Us=a("span",{class:"text-xl"},"Associa media",-1),$s=a("span",{class:"bg-transparent text-[1.5rem] block outline-none focus:outline-none"},"\xD7",-1),Hs=[$s],Ys={class:"relative p-4 flex-auto overflow-y-auto"},Bs={class:"flex flex-wrap"},zs=["onClick"],Fs={class:"flex items-center justify-end p-4 border-t border-solid border-border rounded-b"},Gs={key:1,class:"opacity-25 fixed inset-0 z-40 bg-black"};function Ws(e,t,i,r,s,l){const o=v("TrashIcon"),c=v("PlusIcon"),x=v("Tree"),p=v("MetsText"),m=v("XIcon"),h=v("MetsCard");return d(),n(g,null,[a("div",bs,[a("div",gs,[a("div",vs,[xs,a("div",_s,[T(a("div",ws,[a("a",{class:w(["text-primary",{"pointer-events-none opacity-50":!s.selectedNode}]),onClick:t[0]||(t[0]=(...u)=>l.deleteNode&&l.deleteNode(...u))},[y(o,{class:"h-4"})],2)],512),[[Y,s.treeDisplayData.length]]),a("div",Is,[a("div",null,[a("div",ks,[a("a",{class:"text-primary dropdown-toggle transition duration-150 ease-in-out flex items-center whitespace-nowrap",href:"#",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[1]||(t[1]=ke((...u)=>l.toggleDropdown&&l.toggleDropdown(...u),["prevent"]))},[y(c,{class:"h-4"})]),T(a("ul",As,[a("li",null,[a("a",{class:"dropdown-item text-sm py-1 px-4 font-normal block w-full whitespace-nowrap bg-transparent",href:"#",onClick:t[2]||(t[2]=(...u)=>l.addNode&&l.addNode(...u))},"Aggiungi allo stesso livello")]),a("li",null,[a("a",{class:"dropdown-item text-sm py-1 px-4 font-normal block w-full whitespace-nowrap bg-transparent",href:"#",onClick:t[3]||(t[3]=u=>l.addNode(u,!0))},"Aggiungi figlio")])],512),[[Y,s.state]])])])],512)])]),y(x,{id:"logical-tree",ref:"logical-tree","custom-options":l.treeOptions,"custom-styles":l.treeStyles,nodes:s.treeDisplayData},null,8,["custom-options","custom-styles","nodes"])]),s.selectedNode?(d(),n("div",Ms,[y(p,{id:"text",field:{label:"Nome",labelLeft:!0},model:s.selectedNode,onUpdate:l.updateName},null,8,["model","onUpdate"]),a("div",Es,[Ts,a("div",Ss,[a("a",{class:"flex items-center mr-4 text-primary font-semibold text-[13px]",onClick:t[4]||(t[4]=(...u)=>l.toggleModal&&l.toggleModal(...u))},[y(c,{class:"h-4"}),Cs]),a("a",{class:w(["flex items-center text-primary font-semibold text-[13px]",{"pointer-events-none opacity-50":!s.selectedMedia.length}]),onClick:t[5]||(t[5]=(...u)=>l.removeMedia&&l.removeMedia(...u))},[y(m,{class:"h-4"}),Ds],2)])]),a("div",Os,[a("div",Ls,[(d(!0),n(g,null,M(s.selectedNode.media,u=>(d(),n(g,{key:u["mets.fptr"][0].FILEID},[u.thumbnail?(d(),n("div",{key:0,class:w(["m-1 cursor-pointer",{"outline outline-2 outline-primary":s.selectedMedia.indexOf(u["mets.fptr"][0].FILEID)>-1}]),onClick:f=>l.toggleMedia(u["mets.fptr"][0].FILEID)},[y(h,{file:u,options:{enableEdit:!1,enableRemove:!1}},null,8,["file"])],10,Ns)):_("",!0)],64))),128))])])])):_("",!0)]),s.showModal?(d(),n("div",Vs,[a("div",js,[a("div",Rs,[a("div",Ps,[Us,a("button",{class:"ml-auto bg-transparent border-0 text-black float-right hover:text-primary text-xl leading-none font-semibold outline-none focus:outline-none",onClick:t[6]||(t[6]=(...u)=>l.toggleModal&&l.toggleModal(...u))},Hs)]),a("div",Ys,[a("div",Bs,[(d(!0),n(g,null,M(l._media,u=>(d(),n(g,{key:u["mets.fptr"][0].FILEID},[!s.selectedNode.media.find(f=>f["mets.fptr"][0].FILEID===u["mets.fptr"][0].FILEID)&&u.thumbnail?(d(),n("div",{key:0,class:w(["m-1 cursor-pointer",{"outline outline-2 outline-primary":s.selectedMedia.indexOf(u["mets.fptr"][0].FILEID)>-1}]),onClick:f=>l.toggleMedia(u["mets.fptr"][0].FILEID)},[y(h,{file:u,options:{enableEdit:!1,enableRemove:!1}},null,8,["file"])],10,zs)):_("",!0)],64))),128))])]),a("div",Fs,[a("button",{class:"text-black hover:text-primary background-transparent font-semibold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",type:"button",onClick:t[7]||(t[7]=(...u)=>l.toggleModal&&l.toggleModal(...u))},"Annulla"),a("button",{class:"text-primary bg-transparent border border-solid border-primary hover:bg-primary hover:text-white active:bg-primary font-semibold uppercase text-sm px-6 py-2 outline-none focus:outline-none mr-1 ease-linear transition-all duration-150",type:"button",onClick:t[8]||(t[8]=u=>l.toggleModal(!0))},"Conferma")])])])])):_("",!0),s.showModal?(d(),n("div",Gs)):_("",!0)],64)}var Js=I(ys,[["render",Ws]]);const qs={emits:["update","delete"],components:{TrashIcon:j},props:{id:String,field:Object,model:Object},data(){return{data:this.model}},methods:{update(e){debugger;this.$emit("update",e)},addRecord(){let e={};Object.keys(this.field.child).forEach(t=>{e[t]=this.field.child[t].default!==void 0?JSON.parse(JSON.stringify(this.field.child[t].default)):this.field.child[t].default}),this.data.push(e),this.update({key:this.id,value:this.data})},removeRecord(e){this.data.splice(e,1),this.update({key:this.id,value:this.data})}}},Ks={class:"border-2 border-border p-2.5"},Xs={class:"px-2.5 text-lg text-primary"},Zs={key:1,class:"flex"},Qs=a("div",{class:"w-[30px] flex flex-col items-end"},null,-1),ei={class:"w-[calc(100%-30px)]"};function ti(e,t,i,r,s,l){const o=v("MetsWrapper");return d(),n("fieldset",Ks,[a("legend",Xs,S(i.field.label),1),i.field.multi?(d(),n(g,{key:0},[],64)):(d(),n("div",Zs,[Qs,a("div",ei,[(d(!0),n(g,null,M(i.field.child,(c,x)=>(d(),n("div",{key:x,class:"mb-5 ml-5"},[y(o,{_key:x,value:c,model:s.data,"force-update":i.field.forceUpdate,id:i.id,onUpdate:l.update},null,8,["_key","value","model","force-update","id","onUpdate"])]))),128))])]))])}var li=I(qs,[["render",ti]]);const si={emits:["update","delete"],components:{"v-select":K},props:{id:String,field:Object,model:Object},computed:{options(){let e=JSON.parse(JSON.stringify(this.field.values));return this.field.mandatory||e.unshift("-"),e},inputVal:{get(){return(this.model[this.id]?this.model[this.id][0]:"").value},set(e){this.checkModel(),this.model[this.id][0].value=e,this.update()}},selectVal:{get(){return(this.model[this.id]?this.model[this.id][0]:"").qualifier},set(e){e==="-"&&(e=""),this.checkModel(),this.model[this.id][0].qualifier=e,this.update()}},inputVal2:{get(){return(this.model[this.id]?this.model[this.id][1]:"").value},set(e){this.checkModel(),this.model[this.id][1].value=e,this.update()}},selectVal2:{get(){return(this.model[this.id]?this.model[this.id][1]:"").qualifier},set(e){e==="-"&&(e=""),this.checkModel(),this.model[this.id][1].qualifier=e,this.update()}}},methods:{checkModel(){(!this.model[this.id]||this.model[this.id].length<2)&&(this.model[this.id]=[{qualifier:"",point:"start",value:""},{qualifier:"",point:"end",value:""}])},update(){this.$emit("update",{key:this.id,value:this.model[this.id]})}}},ii={class:"flex h-[30px] mb-5"},ai=a("div",{class:"flex pr-2 items-start w-1/5 justify-end"},[a("span",null,"Data inizio")],-1),ri={class:"flex items-center flex-col w-4/5"},oi=["disabled"],di={class:"flex h-[30px] mb-5"},ni=a("div",{class:"flex pr-2 items-start w-1/5 justify-end"},[a("span",null,"Qualifica")],-1),ci={class:"flex items-center flex-col w-4/5"},ui={class:"flex h-[30px] mb-5"},mi=a("div",{class:"flex pr-2 items-start w-1/5 justify-end"},[a("span",null,"Data fine")],-1),hi={class:"flex items-center flex-col w-4/5"},pi=["disabled"],fi={class:"flex h-[30px]"},yi=a("div",{class:"flex pr-2 items-start w-1/5 justify-end"},[a("span",null,"Qualifica")],-1),bi={class:"flex items-center flex-col w-4/5"};function gi(e,t,i,r,s,l){const o=v("v-select");return d(),n(g,null,[a("div",ii,[ai,a("div",ri,[T(a("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>l.inputVal=c),class:"w-11/12 h-[30px] border border-border px-[5px] focus:outline-0 focus:border-primary",type:"text",disabled:i.field.readonly},null,8,oi),[[O,l.inputVal]])])]),a("div",di,[ni,a("div",ci,[y(o,{modelValue:l.selectVal,"onUpdate:modelValue":t[1]||(t[1]=c=>l.selectVal=c),options:l.options,class:"select w-11/12 h-full p-0"},null,8,["modelValue","options"])])]),a("div",ui,[mi,a("div",hi,[T(a("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>l.inputVal2=c),class:"w-11/12 h-[30px] border border-border px-[5px] focus:outline-0 focus:border-primary",type:"text",disabled:i.field.readonly},null,8,pi),[[O,l.inputVal2]])])]),a("div",fi,[yi,a("div",bi,[y(o,{modelValue:l.selectVal2,"onUpdate:modelValue":t[3]||(t[3]=c=>l.selectVal2=c),options:l.options,class:"select w-11/12 h-full p-0"},null,8,["modelValue","options"])])])],64)}var vi=I(si,[["render",gi]]);const xi=Te(),P=Ae(tt);P.use(Jt);P.component("tabs",Me).component("tab",Ee).component("MetsWrapper",Xt).component("MetsText",ul).component("MetsGroup",kl).component("MetsVocabolary",Ll).component("MetsCheck",Ul).component("MetsCard",us).component("MetsSortable",fs).component("MetsLogical",Js).component("MetsBlock",li).component("MetsRange",vi);P.config.globalProperties.emitter=xi;P.mount("#app");
